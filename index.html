<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Curro</title>

<link rel="icon" href="icon.png">
<link rel="apple-touch-icon" href="icon.png">
<meta name="apple-mobile-web-app-capable" content="yes">

<style>
@font-face{
  font-family:Digital;
  src:url("https://fonts.gstatic.com/s/digital7/d-6IYplOFocCacKzxw.ttf");
}

body{
  margin:0;
  background:#000;
  color:#fff;
  font-family:Arial,sans-serif;
  text-align:center;
  padding:15px;
}

.digital{font-family:Digital;}
.big{font-size:2.2em}
.medium{font-size:1.5em}
.small{font-size:1.1em}
.tiny{font-size:.9em;color:#aaa}

.line{width:80%;border-top:1px solid #fff;margin:14px auto}

.clock{font-size:3em;margin-bottom:15px}

#calendar{
  display:grid;
  grid-template-columns:repeat(7,42px);
  gap:6px;
  justify-content:center;
}

.week{font-size:10px;opacity:.6}

.day{
  border:1px solid #fff;
  border-radius:6px;
  padding:4px 0;
  font-size:11px;
}

.red{background:#400}
.festive{border:2px solid gold}
.today{outline:2px solid #fff}

select{
  background:#000;
  color:#fff;
  border:1px solid #333;
  font-size:9px;
}
</style>
</head>

<body>

<div id="clock" class="digital clock">00:00:00</div>

<div class="small">HOY</div>
<div id="todayTime" class="digital medium">00:00</div>
<div id="todayMoney" class="digital small">0,00 â‚¬</div>

<div class="line"></div>

<div class="small">TOTAL</div>
<div id="totalTime" class="digital big">00:00</div>
<div id="totalMoney" class="digital big">0,00 â‚¬</div>

<div class="line"></div>

<div class="tiny">ðŸ”¥ RACHA</div>
<div id="streak" class="digital medium">0</div>
<div class="tiny">faltan <span id="rest">5</span> dÃ­as para descansar</div>

<div class="line"></div>

<div id="calendar"></div>

<script>
const RATE=14;
const REST_AFTER=5;

const SHIFTS={
  maÃ±ana:{start:420,end:840},
  tarde:{start:840,end:1230}
};

let data=JSON.parse(localStorage.getItem("curro"))||{};

const fmt=m=>`${String(Math.floor(m/60)).padStart(2,"0")}:${String(m%60).padStart(2,"0")}`;
const key=d=>`${d.getFullYear()}-${d.getMonth()+1}-${d.getDate()}`;

function clock(){
  const n=new Date();
  document.getElementById("clock").textContent=
  `${String(n.getHours()).padStart(2,"0")}:${String(n.getMinutes()).padStart(2,"0")}:${String(n.getSeconds()).padStart(2,"0")}`;
}

function calendar(){
  const cal=document.getElementById("calendar");
  cal.innerHTML="";
  const now=new Date();
  const y=now.getFullYear(),m=now.getMonth(),t=now.getDate();
  const days=new Date(y,m+1,0).getDate();
  const week=["L","M","X","J","V","S","D"];

  week.forEach(w=>{
    const e=document.createElement("div");
    e.className="week";e.textContent=w;
    cal.appendChild(e);
  });

  for(let d=1;d<=days;d++){
    const k=`${y}-${m+1}-${d}`;
    if(!data[k])data[k]={off:false,shift:"tarde",festive:false,minutes:0};

    const el=document.createElement("div");
    el.className="day";
    el.textContent=d;
    if(data[k].off)el.classList.add("red");
    if(data[k].festive)el.classList.add("festive");
    if(d===t)el.classList.add("today");

    el.onclick=()=>{
      data[k].off=!data[k].off;
      save();calendar();calc();
    };

    el.oncontextmenu=e=>{
      e.preventDefault();
      data[k].festive=!data[k].festive;
      save();calendar();calc();
    };

    cal.appendChild(el);
  }
}

function calc(){
  const now=new Date();
  const todayKey=key(now);
  let totalMin=0,totalMoney=0,streak=0;

  Object.keys(data).sort().forEach(k=>{
    const d=data[k];
    if(d.off)return;

    let mins=d.minutes;
    if(k===todayKey){
      const s=SHIFTS[d.shift];
      let cur=now.getHours()*60+now.getMinutes();
      if(cur>s.end)cur=s.end;
      if(cur>s.start)mins=cur-s.start;
      d.minutes=mins;
    }

    const mult=d.festive?2:1;
    totalMin+=mins;
    totalMoney+=(mins/60)*RATE*mult;
  });

  let keys=Object.keys(data).sort().reverse();
  for(let k of keys){
    if(!data[k].off && data[k].minutes>0)streak++;
    else break;
  }

  document.getElementById("todayTime").textContent=fmt(data[todayKey]?.minutes||0);
  document.getElementById("todayMoney").textContent=((data[todayKey]?.minutes||0)/60*RATE).toFixed(2)+" â‚¬";
  document.getElementById("totalTime").textContent=fmt(totalMin);
  document.getElementById("totalMoney").textContent=totalMoney.toFixed(2)+" â‚¬";
  document.getElementById("streak").textContent="ðŸ”¥ "+streak;
  document.getElementById("rest").textContent=Math.max(0,REST_AFTER-streak);

  save();
}

function save(){
  localStorage.setItem("curro",JSON.stringify(data));
}

calendar();
clock();
calc();
setInterval(clock,1000);
setInterval(calc,1000);
</script>

</body>
</html>
