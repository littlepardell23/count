<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://fonts.googleapis.com/css2?family=Orbitron&display=swap" rel="stylesheet">

<style>
body{
  margin:0;
  background:#000;
  color:#fff;
  font-family:'Orbitron', monospace;
  display:flex;
  justify-content:center;
}
.app{width:100%;max-width:420px;padding:16px}

/* CUADRADOS */
.grid{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:10px;
}
.box{
  border:1px solid #fff;
  padding:12px;
  text-align:center;
}
.big{font-size:22px}
.mid{font-size:16px}
.small{font-size:12px;color:#aaa}

.line{border-top:1px solid #444;margin:12px 0}

/* CALENDARIO */
.calendar{margin-top:10px}
.week,.days{
  display:grid;
  grid-template-columns:repeat(7,1fr);
  text-align:center;
}
.week{font-size:11px;opacity:.6}
.day{
  border:1px solid #333;
  padding:10px 0;
  margin:3px;
  border-radius:6px;
}
.work{background:#fff;color:#000}
.festivo{outline:2px solid #fff}

/* POPUP */
#popup{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.9);
  display:none;
  justify-content:center;
  align-items:center;
}
.popup{
  border:1px solid #fff;
  padding:20px;
  width:80%;
}
.popup button{
  width:100%;
  margin:6px 0;
  padding:10px;
  background:#000;
  color:#fff;
  border:1px solid #fff;
  font-family:inherit;
}
</style>
</head>

<body>
<div class="app">

<!-- 4 CUADRADOS -->
<div class="grid">
  <div class="box">
    <div class="small">HOY</div>
    <div class="big" id="todayTime">00:00</div>
    <div class="mid" id="todayMoney">0.00 â‚¬</div>
  </div>

  <div class="box">
    <div class="small">TOTAL â‚¬</div>
    <div class="big" id="totalMoney">0.00</div>
  </div>

  <div class="box">
    <div class="small">TOTAL HORAS</div>
    <div class="big" id="totalHours">0.00</div>
  </div>

  <div class="box">
    <div class="small">RACHA</div>
    <div class="big" id="streak">ðŸ”¥0</div>
  </div>
</div>

<!-- CONTADORES PEQUEÃ‘OS -->
<div class="line"></div>
<div class="grid">
  <div class="box">
    <div class="small">MAÃ‘ANA</div>
    <div class="mid" id="morningDays">0</div>
  </div>
  <div class="box">
    <div class="small">TARDE</div>
    <div class="mid" id="afternoonDays">0</div>
  </div>
</div>

<!-- CALENDARIO -->
<div class="calendar">
  <div class="week">
    <div>L</div><div>M</div><div>X</div><div>J</div><div>V</div><div>S</div><div>D</div>
  </div>
  <div class="days" id="calendar"></div>
</div>

</div>

<!-- POPUP -->
<div id="popup">
  <div class="popup">
    <button onclick="setDay('maÃ±ana',false)">MaÃ±ana</button>
    <button onclick="setDay('tarde',false)">Tarde</button>
    <button onclick="setDay('tarde',true)">Festivo (x2)</button>
    <button onclick="setDay('maÃ±ana',true)">MaÃ±ana festivo (x2)</button>
    <button onclick="closePopup()">Cancelar</button>
  </div>
</div>

<script>
const RATE=0.23;
const SHIFTS={
  maÃ±ana:{start:7*60,end:14*60},
  tarde:{start:14*60,end:20*60+30}
};

let data=JSON.parse(localStorage.getItem("days"))||{};
let selectedDay=null;

const now=new Date();
const y=now.getFullYear(), m=now.getMonth(), d=now.getDate();

function k(day){return `${y}-${m+1}-${day}`}

function openPopup(day){
  selectedDay=day;
  document.getElementById("popup").style.display="flex";
}
function closePopup(){
  document.getElementById("popup").style.display="none";
}
function setDay(shift,festivo){
  data[k(selectedDay)]={shift,festivo};
  localStorage.setItem("days",JSON.stringify(data));
  closePopup();
  render();
}

function render(){
  const cal=document.getElementById("calendar");
  cal.innerHTML="";
  const daysInMonth=new Date(y,m+1,0).getDate();

  for(let i=1;i<=daysInMonth;i++){
    const el=document.createElement("div");
    el.className="day";
    el.textContent=i;
    if(data[k(i)]){
      el.classList.add("work");
      if(data[k(i)].festivo) el.classList.add("festivo");
    }
    el.onclick=()=>openPopup(i);
    cal.appendChild(el);
  }
  calc();
}

function calc(){
  let totalMin=0, todayMin=0;
  let morning=0, afternoon=0;

  const nowMin=now.getHours()*60+now.getMinutes();

  Object.keys(data).forEach(key=>{
    const conf=data[key];
    const shift=SHIFTS[conf.shift];
    let min=shift.end-shift.start;

    const day=parseInt(key.split("-")[2]);
    if(day===d){
      todayMin=Math.max(0,Math.min(nowMin,shift.end)-shift.start);
      min=todayMin;
    }
    if(conf.festivo) min*=2;
    totalMin+=min;

    conf.shift==="maÃ±ana" ? morning++ : afternoon++;
  });

  document.getElementById("todayTime").textContent=format(todayMin);
  document.getElementById("todayMoney").textContent=(todayMin*RATE).toFixed(2)+" â‚¬";
  document.getElementById("totalHours").textContent=(totalMin/60).toFixed(2);
  document.getElementById("totalMoney").textContent=(totalMin*RATE).toFixed(2);
  document.getElementById("morningDays").textContent=morning;
  document.getElementById("afternoonDays").textContent=afternoon;
  document.getElementById("streak").textContent="ðŸ”¥"+calcStreak();
}

function calcStreak(){
  let c=0;
  for(let i=d;i>0;i--){
    if(data[k(i)]) c++;
    else break;
  }
  return c;
}

function format(min){
  const h=Math.floor(min/60);
  const m=min%60;
  return `${h.toString().padStart(2,"0")}:${m.toString().padStart(2,"0")}`;
}

render();
setInterval(calc,1000);
</script>
</body>
</html>
