<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Contador Curro</title>

<link rel="icon" href="icon.png">
<link rel="apple-touch-icon" href="icon.png">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">

<style>
@font-face{
  font-family:Digital;
  src:url('https://fonts.gstatic.com/s/digital7/d-6IYplOFocCacKzxw.ttf');
}

body{
  margin:0;
  background:#000;
  color:#fff;
  font-family:Arial,sans-serif;
  display:flex;
  flex-direction:column;
  align-items:center;
  padding:20px;
}

.digital{font-family:Digital;}
.big{font-size:2.8em}
.medium{font-size:1.8em}
.small{font-size:1.2em}
.tiny{font-size:1em;color:#aaa}

.clock{
  font-size:3.6em;
  letter-spacing:3px;
  margin-bottom:25px;
}

.counter{text-align:center;margin:10px 0}
.line{width:80%;border-top:1px solid #fff;margin:15px 0}

/* CALENDARIO */
#calendar{
  display:grid;
  grid-template-columns:repeat(7,42px);
  gap:6px;
  margin-top:20px;
}

.week{
  font-size:10px;
  opacity:.6;
  text-align:center;
}

.day{
  width:42px;
  height:42px;
  line-height:42px;
  text-align:center;
  border:1px solid #fff;
  border-radius:6px;
}

.red{background:#400}
.today{border:2px solid #fff}
</style>
</head>

<body>

<div id="clock" class="digital clock">00:00:00</div>

<div class="counter small">
  <div>HOY</div>
  <div id="timeToday" class="digital">00:00</div>
</div>

<div class="counter medium">
  <div>HOY €</div>
  <div id="moneyToday" class="digital">0,00</div>
</div>

<div class="line"></div>

<div class="counter big">
  <div>TOTAL HORAS</div>
  <div id="totalTime" class="digital big">00:00</div>
</div>

<div class="counter big">
  <div>TOTAL €</div>
  <div id="totalMoney" class="digital big">0,00</div>
</div>

<div class="line"></div>

<div class="counter small">
  <div>MEDIA / DÍA</div>
  <div id="avgDay" class="digital">0,00</div>
</div>

<div class="counter tiny">
  <div>DÍAS TRABAJADOS</div>
  <div id="daysWorked" class="digital">0</div>
</div>

<div id="calendar"></div>

<script>
/* CONFIG */
const START="14:00";
const END="20:30";
const RATE=14;

/* STORAGE */
let data=JSON.parse(localStorage.getItem("workData"))||{};

/* UTILS */
const parse=t=>{const[a,b]=t.split(":").map(Number);return a*60+b}
const fmt=m=>`${String(Math.floor(m/60)).padStart(2,"0")}:${String(m%60).padStart(2,"0")}`
const key=d=>`${d.getFullYear()}-${d.getMonth()+1}-${d.getDate()}`

/* PRE-CARGA → 4 DÍAS TRABAJADOS */
(function preload(){
  if(Object.keys(data).length) return;
  const base=new Date();
  for(let i=1;i<=4;i++){
    const d=new Date(base);
    d.setDate(base.getDate()-i);
    data[key(d)]={off:false,minutes:390}; // 6h30
  }
  localStorage.setItem("workData",JSON.stringify(data));
})();

/* CLOCK */
function clock(){
  const n=new Date();
  document.getElementById("clock").textContent=
  `${String(n.getHours()).padStart(2,"0")}:${String(n.getMinutes()).padStart(2,"0")}:${String(n.getSeconds()).padStart(2,"0")}`;
}

/* CALENDAR */
function calendar(){
  const cal=document.getElementById("calendar");
  cal.innerHTML="";
  const now=new Date();
  const y=now.getFullYear(),m=now.getMonth(),t=now.getDate();
  const first=new Date(y,m,1).getDay();
  const days=new Date(y,m+1,0).getDate();
  const week=["L","M","X","J","V","S","D"];

  week.forEach(w=>{
    const el=document.createElement("div");
    el.className="week";
    el.textContent=w;
    cal.appendChild(el);
  });

  for(let i=0;i<(first===0?6:first-1);i++)
    cal.appendChild(document.createElement("div"));

  for(let d=1;d<=days;d++){
    const k=`${y}-${m+1}-${d}`;
    if(!data[k])data[k]={off:false,minutes:0};

    const el=document.createElement("div");
    el.className="day";
    el.textContent=d;
    if(data[k].off)el.classList.add("red");
    if(d===t)el.classList.add("today");

    el.onclick=()=>{
      data[k].off=!data[k].off;
      localStorage.setItem("workData",JSON.stringify(data));
      calendar();update();
    };
    cal.appendChild(el);
  }
}

/* UPDATE */
function update(){
  const now=new Date();
  const k=key(now);
  if(!data[k])data[k]={off:false,minutes:0};

  let todayMin=0;
  if(!data[k].off){
    const s=parse(START),e=parse(END);
    let cur=now.getHours()*60+now.getMinutes();
    if(cur>e)cur=e;
    if(cur>s)todayMin=cur-s;
  }

  document.getElementById("timeToday").textContent=fmt(todayMin);
  document.getElementById("moneyToday").textContent=((todayMin/60)*RATE).toFixed(2);

  if(todayMin>data[k].minutes){
    data[k].minutes=todayMin;
    localStorage.setItem("workData",JSON.stringify(data));
  }

  let totalMin=0,days=0;
  Object.values(data).forEach(d=>{
    if(!d.off && d.minutes>0){
      totalMin+=d.minutes;
      days++;
    }
  });

  document.getElementById("totalTime").textContent=fmt(totalMin);
  document.getElementById("totalMoney").textContent=((totalMin/60)*RATE).toFixed(2);
  document.getElementById("avgDay").textContent=(days?((totalMin/60)*RATE/days):0).toFixed(2);
  document.getElementById("daysWorked").textContent=days;
}

calendar();
clock();
update();
setInterval(clock,1000);
setInterval(update,1000);
</script>

</body>
</html>
