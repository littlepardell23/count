<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">


<!-- ICONOS -->
<link rel="icon" href="icon.png">
<link rel="apple-touch-icon" href="icon.png">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">

<link href="https://fonts.googleapis.com/css2?family=Orbitron&display=swap" rel="stylesheet">

<style>
body{
  margin:0;
  background:#000;
  color:#fff;
  font-family:'Orbitron', monospace;
  display:flex;
  justify-content:center;
}
.app{
  width:100%;
  max-width:420px;
  min-height: calc(100vh - env(safe-area-inset-top,16px) - env(safe-area-inset-bottom,16px));
  display:flex;
  flex-direction:column;
  justify-content:center;
  /* padding: top/right/bottom with safe-area insets for iPhone notch/home */
  padding: calc(env(safe-area-inset-top,16px) + 16px) 16px calc(env(safe-area-inset-bottom,16px) + 16px);
}

/* CUADRADOS */
.grid{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.box{border:1px solid #fff;padding:12px;text-align:center}
.big{font-size:22px}
.mid{font-size:16px}
.small{font-size:12px;color:#aaa}

.line{border-top:1px solid #444;margin:10px 0}

/* CALENDARIO */
.calendar .week,.calendar .days{
  display:grid;grid-template-columns:repeat(7,1fr);text-align:center
}
.week{font-size:11px;opacity:.6}
.day{
  border:1px solid #333;
  padding:9px 0;
  margin:3px;
  border-radius:6px;
}
.work{background:#fff;color:#000}
.festivo{outline:2px solid #fff}

/* POPUPS */
.overlay{
  position:fixed;inset:0;
  background:rgba(0,0,0,.9);
  display:none;
  justify-content:center;
  align-items:center;
}
.popup{
  border:1px solid #fff;
  padding:18px;
  width:85%;
}
.popup button{
  width:100%;
  margin:6px 0;
  padding:10px;
  background:#000;
  color:#fff;
  border:1px solid #fff;
  font-family:inherit;
  font-size:13px;
}

.hist-btn{
  margin-top:10px;
  border:1px solid #444;
  padding:6px;
  font-size:11px;
  text-align:center;
}
</style>
</head>

<body>
<div class="app">

<!-- ARRIBA -->
<div>

<div class="grid">
  <div class="box">
    <div class="small">HOY</div>
    <div class="big" id="todayTime">00:00</div>
    <div class="mid" id="todayMoney">0.00 â‚¬</div>
  </div>
  <div class="box">
    <div class="small">TOTAL VIDA â‚¬</div>
    <div class="big" id="lifeMoney">0.00</div>
    <div class="small" id="lifeInfo">Has ganado 8.597 â‚¬ â†’ 622,75 horas.</div>
  </div>
  <div class="box">
    <div class="small">MES â‚¬</div>
    <div class="big" id="monthMoney">0.00</div>
  </div>
  <div class="box">
    <div class="small">RACHA</div>
    <div class="big" id="streak">ðŸ”¥0</div>
  </div>
</div>

<div class="line"></div>

<div class="grid">
  <div class="box">
    <div class="small">MAÃ‘ANA</div>
    <div class="mid" id="morningDays">0</div>
  </div>
  <div class="box">
    <div class="small">TARDE</div>
    <div class="mid" id="afternoonDays">0</div>
  </div>
</div>

<div class="hist-btn" onclick="openHistory()">HISTORIAL</div>

</div>

<!-- ABAJO -->
<div class="calendar">
  <div class="week">
    <div>L</div><div>M</div><div>X</div><div>J</div><div>V</div><div>S</div><div>D</div>
  </div>
  <div class="days" id="calendar"></div>
</div>

</div>

<!-- POPUP DIA -->
<div class="overlay" id="dayPopup">
  <div class="popup">
    <button onclick="setDay('maÃ±ana',false)">MaÃ±ana</button>
    <button onclick="setDay('tarde',false)">Tarde</button>
    <button onclick="setDay('tarde',true)">Festivo (x2)</button>
    <button onclick="setDay('maÃ±ana',true)">MaÃ±ana festivo (x2)</button>
    <button onclick="closeDay()">Cancelar</button>
  </div>
</div>

<!-- HISTORIAL -->
<div class="overlay" id="historyPopup">
  <div class="popup" id="historyBox"></div>
</div>

<script>
const RATE=0.23;
const SHIFTS={
  maÃ±ana:{s:420,e:840},
  tarde:{s:840,e:1230}
};

let days=JSON.parse(localStorage.getItem("days"))||{};
let months=JSON.parse(localStorage.getItem("months"))||{};

let selDay=null;
const now=new Date();
const y=now.getFullYear(), m=now.getMonth(), d=now.getDate();
const monthKey=`${y}-${m+1}`;

function k(day){return `${monthKey}-${day}`}

function fmtNumber(n){
  return Number(n).toLocaleString('es-ES', {minimumFractionDigits:2, maximumFractionDigits:2});
}

function openDay(day){
  selDay=day;
  document.getElementById("dayPopup").style.display="flex";
}
function closeDay(){
  document.getElementById("dayPopup").style.display="none";
}
function setDay(shift,festivo){
  days[k(selDay)]={shift,festivo};
  localStorage.setItem("days",JSON.stringify(days));
  closeDay(); render();
}

function openHistory(){
  const box=document.getElementById("historyBox");
  box.innerHTML="";
  Object.keys(months).forEach(mk=>{
    box.innerHTML+=`<div>${mk} â€” ${fmtNumber(months[mk])} â‚¬</div>`;
  });
  const totalLife = Object.values(months).reduce((a,b)=>a+(parseFloat(b)||0),0);
  box.innerHTML+=`<div style="margin-top:10px">TOTAL VIDA â€” ${fmtNumber(totalLife)} â‚¬</div>`;
  box.innerHTML+=`<button onclick="closeHistory()">Cerrar</button>`;
  document.getElementById("historyPopup").style.display="flex";
}
function closeHistory(){
  document.getElementById("historyPopup").style.display="none";
}

function render(){
  const cal=document.getElementById("calendar");
  cal.innerHTML="";
  const daysInMonth=new Date(y,m+1,0).getDate();

  let totalMin=0, monthMin=0, morning=0, afternoon=0;

  Object.keys(days).forEach(kd=>{
    const conf=days[kd];
    let min=SHIFTS[conf.shift].e-SHIFTS[conf.shift].s;
    if(conf.festivo) min*=2;
    totalMin+=min;
    if(kd.startsWith(monthKey)){
      monthMin+=min;
      conf.shift==="maÃ±ana"?morning++:afternoon++;
    }
  });

  // actualizar UI
  document.getElementById("monthMoney").innerText=fmtNumber(monthMin*RATE);
  // guardar por mes
  months[monthKey]=parseFloat((monthMin*RATE).toFixed(2));
  localStorage.setItem("months",JSON.stringify(months));

  const lifeMoneyTotal = totalMin*RATE;
  document.getElementById("lifeMoney").innerText=fmtNumber(lifeMoneyTotal);
  document.getElementById("lifeInfo").innerText = `Has ganado ${fmtNumber(lifeMoneyTotal)} â‚¬ â†’ ${(totalMin/60).toLocaleString('es-ES', {minimumFractionDigits:2, maximumFractionDigits:2})} horas.`;

  document.getElementById("morningDays").innerText=morning;
  document.getElementById("afternoonDays").innerText=afternoon;
  document.getElementById("streak").innerText="ðŸ”¥"+Object.keys(days).length;

  for(let i=1;i<=daysInMonth;i++){
    const el=document.createElement("div");
    el.className="day";
    el.textContent=i;
    if(days[k(i)]){
      el.classList.add("work");
      if(days[k(i)].festivo) el.classList.add("festivo");
    }
    el.onclick=()=>openDay(i);
    cal.appendChild(el);
  }
}

render();
</script>

</body>
</html>
