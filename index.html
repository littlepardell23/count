<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://fonts.googleapis.com/css2?family=Orbitron&display=swap" rel="stylesheet">

<style>
body{
  margin:0;
  background:#000;
  color:#fff;
  font-family:'Orbitron', monospace;
  display:flex;
  justify-content:center;
}
.app{width:100%;max-width:420px;padding:16px}

.counter{margin:10px 0;text-align:center}
.big{font-size:26px}
.mid{font-size:18px}
.small{font-size:13px;color:#aaa}

.line{border-top:1px solid #444;margin:12px 0}

.calendar{margin-top:14px}
.week,.days{display:grid;grid-template-columns:repeat(7,1fr);text-align:center}
.week{font-size:11px;opacity:.6}
.day{
  border:1px solid #333;
  padding:10px 0;
  margin:3px;
  border-radius:6px;
}
.work{background:#fff;color:#000}
.festivo{outline:2px solid #fff}

#popup{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.9);
  display:none;
  justify-content:center;
  align-items:center;
}
.popup-box{
  border:1px solid #fff;
  padding:20px;
  text-align:center;
}
.popup-box button{
  display:block;
  width:100%;
  margin:8px 0;
  padding:10px;
  background:#000;
  color:#fff;
  border:1px solid #fff;
  font-family:inherit;
}
</style>
</head>

<body>
<div class="app">

<div class="counter small">HOY</div>
<div class="counter big" id="todayTime">00:00</div>
<div class="counter mid" id="todayMoney">0.00 ‚Ç¨</div>

<div class="line"></div>

<div class="counter mid">TOTAL HORAS</div>
<div class="counter big" id="totalHours">0.00</div>

<div class="counter mid">TOTAL ‚Ç¨</div>
<div class="counter big" id="totalMoney">0.00</div>

<div class="line"></div>

<div class="counter small">RACHA</div>
<div class="counter mid" id="streak">üî•0</div>

<div class="calendar">
  <div class="week">
    <div>L</div><div>M</div><div>X</div><div>J</div><div>V</div><div>S</div><div>D</div>
  </div>
  <div class="days" id="calendar"></div>
</div>

</div>

<!-- POPUP -->
<div id="popup">
  <div class="popup-box">
    <button onclick="setDay('ma√±ana',false)">Ma√±ana</button>
    <button onclick="setDay('tarde',false)">Tarde</button>
    <button onclick="setDay('tarde',true)">Festivo (x2)</button>
    <button onclick="setDay('ma√±ana',true)">Ma√±ana Festivo (x2)</button>
    <button onclick="closePopup()">Cancelar</button>
  </div>
</div>

<script>
const RATE = 0.23;
const SHIFTS = {
  ma√±ana:{start:7*60,end:14*60},
  tarde:{start:14*60,end:20*60+30}
};

let data = JSON.parse(localStorage.getItem("days")) || {};
let selectedDay=null;

const today=new Date();
const y=today.getFullYear(), m=today.getMonth(), d=today.getDate();

function key(day){return `${y}-${m+1}-${day}`}

function openPopup(day){
  selectedDay=day;
  document.getElementById("popup").style.display="flex";
}
function closePopup(){
  document.getElementById("popup").style.display="none";
}
function setDay(shift,festivo){
  data[key(selectedDay)]={shift,festivo};
  localStorage.setItem("days",JSON.stringify(data));
  closePopup();
  render();
}

function render(){
  const cal=document.getElementById("calendar");
  cal.innerHTML="";
  const daysInMonth=new Date(y,m+1,0).getDate();

  for(let i=1;i<=daysInMonth;i++){
    const el=document.createElement("div");
    el.className="day";
    el.textContent=i;
    const k=key(i);

    if(data[k]){
      el.classList.add("work");
      if(data[k].festivo) el.classList.add("festivo");
    }
    el.onclick=()=>openPopup(i);
    cal.appendChild(el);
  }
  calc();
}

function calc(){
  let totalMin=0;
  let todayMin=0;

  const nowMin=today.getHours()*60+today.getMinutes();

  Object.keys(data).forEach(k=>{
    const [yy,mm,dd]=k.split("-").map(Number);
    const conf=data[k];
    const shift=SHIFTS[conf.shift];
    let min=shift.end-shift.start;

    if(dd===d){
      todayMin=Math.max(0,Math.min(nowMin,shift.end)-shift.start);
      min=todayMin;
    }
    if(conf.festivo) min*=2;
    totalMin+=min;
  });

  document.getElementById("todayTime").textContent=format(todayMin);
  document.getElementById("todayMoney").textContent=(todayMin*RATE).toFixed(2)+" ‚Ç¨";
  document.getElementById("totalHours").textContent=(totalMin/60).toFixed(2);
  document.getElementById("totalMoney").textContent=(totalMin*RATE).toFixed(2);
  document.getElementById("streak").textContent="üî•"+calcStreak();
}

function calcStreak(){
  let c=0;
  for(let i=d;i>0;i--){
    if(data[key(i)]) c++;
    else break;
  }
  return c;
}

function format(min){
  const h=Math.floor(min/60);
  const m=min%60;
  return `${h.toString().padStart(2,"0")}:${m.toString().padStart(2,"0")}`;
}

render();
setInterval(calc,1000);
</script>
</body>
</html>
