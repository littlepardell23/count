<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://fonts.googleapis.com/css2?family=Orbitron&display=swap" rel="stylesheet">

<style>
body{
  margin:0;
  background:#000;
  color:#fff;
  font-family:'Orbitron', monospace;
  display:flex;
  justify-content:center;
}
.app{
  max-width:420px;
  width:100%;
  padding:16px;
}
.stats{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:10px;
}
.card{
  border:1px solid #fff;
  padding:10px;
  text-align:center;
  font-size:14px;
}
.big{font-size:24px}
.calendar{margin-top:15px}
.week, .days{
  display:grid;
  grid-template-columns:repeat(7,1fr);
  text-align:center;
}
.week{opacity:.6;font-size:12px}
.day{
  border:1px solid #555;
  padding:10px 0;
  margin:4px;
  font-size:13px;
}
.work{background:#fff;color:#000}
.double{box-shadow:0 0 8px #fff}
.fire{font-size:18px}
</style>
</head>

<body>
<div class="app">

<div class="stats">
  <div class="card">DESCANSO EN<br><span id="rest" class="big">0</span></div>
  <div class="card">RACHA<br><span id="streak" class="fire">ðŸ”¥0</span></div>
  <div class="card">HORAS MES<br><span id="hours" class="big">0</span></div>
  <div class="card">â‚¬ MES<br><span id="money" class="big">0.00</span></div>
</div>

<div class="calendar">
  <div class="week">
    <div>L</div><div>M</div><div>X</div><div>J</div><div>V</div><div>S</div><div>D</div>
  </div>
  <div class="days" id="calendar"></div>
</div>

</div>

<script>
const PRICE_MIN = 0.23;
const MORNING_MIN = 420; // 7h
const AFTERNOON_MIN = 390; // 14:00 a 20:30
const REST_AFTER = 6; // descansas cada 6 dÃ­as

const now = new Date();
const key = `${now.getFullYear()}-${now.getMonth()}`;
let data = JSON.parse(localStorage.getItem(key)) || {};

const cal = document.getElementById("calendar");

function calc(){
  let totalMin=0;
  let streak=0;
  let maxStreak=0;
  let lastDay=null;

  const days = Object.keys(data).map(Number).sort((a,b)=>a-b);

  days.forEach(d=>{
    const day=data[d];
    let min = day.shift==="maÃ±ana" ? MORNING_MIN : AFTERNOON_MIN;
    if(day.festivo) min*=2;
    totalMin+=min;

    if(lastDay===d-1) streak++;
    else streak=1;
    maxStreak=Math.max(maxStreak,streak);
    lastDay=d;
  });

  document.getElementById("hours").innerText=(totalMin/60).toFixed(2);
  document.getElementById("money").innerText=(totalMin*PRICE_MIN).toFixed(2);
  document.getElementById("streak").innerText="ðŸ”¥"+streak;
  document.getElementById("rest").innerText=Math.max(REST_AFTER-streak,0);
}

function save(){
  localStorage.setItem(key,JSON.stringify(data));
  render();
}

function render(){
  cal.innerHTML="";
  const daysInMonth=new Date(now.getFullYear(),now.getMonth()+1,0).getDate();
  for(let i=1;i<=daysInMonth;i++){
    const d=document.createElement("div");
    d.className="day";
    d.innerText=i;

    if(data[i]){
      d.classList.add("work");
      if(data[i].festivo) d.classList.add("double");
    }

    d.onclick=()=>{
      const worked=confirm("Â¿Has trabajado?");
      if(!worked){ delete data[i]; save(); return; }

      const morning=confirm("Â¿Turno de maÃ±ana?");
      const festivo=confirm("Â¿Es festivo?");

      data[i]={shift: morning?"maÃ±ana":"tarde", festivo};
      save();
    };

    cal.appendChild(d);
  }
  calc();
}

render();
</script>

</body>
</html>
